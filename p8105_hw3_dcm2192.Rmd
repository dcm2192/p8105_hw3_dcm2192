---
title: "p8105_hw3_dcm2192"
author: "Dylan Morgan"
date: "2024-10-14"
output: github_document
---

```{r setup, message = FALSE}
library(tidyverse)
library(tidyr)
library(ggridges)
library(patchwork)
library(p8105.datasets)
```

This code contains my answers to P8105 HW 3. 

## Problem 1

Load NY NOAA dataset.
```{r}
data("ny_noaa")
```

The `ny_noaa` dataset is comprised of `r nrow(ny_noaa)` observations of `r ncol(ny_noaa)` variables. Its variables include `id`, which is the weather station ID; `date`, which is the date of observation; `prcp`, the amount of precipitation measured in mm; `snow`, the amount of snowfall measured in mm; `snwd`, the snow depth measured in mm; `tmax` and `tmin`, the maximum and minimum temperatures in degrees Celsius. A significant portion of the `ny_noaa` dataset contains missing data (values of 0 or `NA`) for its measurements of precipitation, snowfall and depth, and temperature. 

Clean NY NOAA dataset.

Create separate columns for year, month, day. Adjust variables to appropriate data types. 
```{r}
ny_noaa <- 
  ny_noaa |>  
  separate(date, into = c("year", "month", "day"), convert = TRUE) |> 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

Find most commmon values for snowfall.
```{r}
ny_noaa |> 
  count(snow) |> 
  arrange(desc(n))
```

The most commonly observed values for snowfall are 0, followed by `NA`. This is because many of these observations are missing data for snowfall, either because none was recorded on that day or because the data was otherwise missing (possibly due to failure to take measurements). Following these, the next most common values are 25mm, 13mm, and 51mm. 

Two-panel plot of average max temp in January and July for all stations and all years. Note observable structures and outliers. 
```{r}
ny_noaa |>  
  group_by(id, year, month) |>  
  filter(month %in% c(1, 7)) |>  
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) |>  
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Average maximum temperature in January and July in each station over the years")
```

The average maximum temperatures were consistently lower in January over the years than in July. Each station appears to follow a consistent pattern in maximum temperature recordings for a given month and year such that they all generally matched one another in magnitude of temperature. One outlier exists in July of approximately 1988 in which the temperature recorded at one station was significantly lower than the other stations at that time. In January of approximately 1983, there was a notably lower temperature recording at one station compared to other stations at that time. 

(i) tmax vs. tmin for full dataset.
```{r}
temp_hex_plot <- ny_noaa |> 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()
```

(ii) plot showing distribution of snowfall values >0 and <100 separately by year.
```{r}
snowfall_ridge_plot <- ny_noaa |>  
  filter(snow < 100, snow > 0) |> 
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges()
```

Create two panel plot with temp_hex_plot and snowfall_ridge_plot.
```{r}
temp_hex_plot + snowfall_ridge_plot
```

## Problem 2

Load demographic and accelerometer data.
```{r}
covar <- read_csv("./data/nhanes_covar.csv")
accel <- read_csv("./data/nhanes_accel.csv")
```

Load, tidy, merge, and otherwise organize the data sets.
```{r}
covar <- 
  covar |> 
  janitor::clean_names() |> 
  rename(
    SEQN = x1, 
    sex = x1_male, 
    age = x3, 
    BMI = x4, 
    education = x1_less_than_high_school
  )
```

```{r}
covar <- 
  covar |> 
  drop_na() |> 
  filter(!(SEQN == "SEQN")) |> 
  mutate(sex = recode(sex, `1` = "male", `2` = "female"),
         education = recode(education, 
                            `1` = "Less than high school", 
                            `2` = "High school equivalent", 
                            `3` = "More than high school"), 
         age = as.numeric(age), 
         BMI = as.numeric(BMI)) |> 
  filter(age >= 21)

accel <- 
  accel |> 
  mutate(SEQN = as.character(SEQN))

covar_accel <- inner_join(covar, accel, by = "SEQN")
```

Education densities for age and sex. 
```{r}
covar_accel |> 
  janitor::tabyl(education, sex)

covar_accel |> 
  ggplot(aes(x = age, 
             y = education, 
             fill = sex)) + 
  geom_density_ridges(alpha = 0.5, 
                      scale = 0.85)
```

There were more younger females than younger males who pursued education that was more than high school. More older females than older males had a high school equivalent level of education. There were more younger males than younger females who had a high school equivalent education level. 



